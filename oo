-- ÿÆÿØŸÖÿßÿ™ Roblox
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local VirtualUser = game:GetService("VirtualUser")

local localPlayer = Players.LocalPlayer
local camera = Workspace.CurrentCamera
local FOVring

-- üõ°Ô∏è ÿ≠ŸÖÿßŸäÿ© ŸàŸáŸÖŸäÿ©
local lastProtectionCheck = tick()
local protectionInterval = math.random(5, 10)
local function performProtection()
    if not settings.enable_protection then return end
    if tick() - lastProtectionCheck >= protectionInterval then
        lastProtectionCheck = tick()
        protectionInterval = math.random(5, 10)
    end
end

-- ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÑÿßÿπÿ® ÿπÿØŸà
local function isEnemy(player)
    if not settings.teamCheck then return true end
    return player.Team == nil or localPlayer.Team == nil or player.Team ~= localPlayer.Team
end

-- ŸÅÿ≠ÿµ ÿ•ÿ∞ÿß ÿßŸÑŸÑÿßÿπÿ® ÿ≠Ÿä
local function isAlive(player)
    return player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0
end

-- ŸÅÿ≠ÿµ ÿßŸÑÿ¨ÿØÿ±ÿßŸÜ
local function isPartVisible(part)
    if not settings.wallCheck then return true end
    local origin = camera.CFrame.Position
    local direction = (part.Position - origin).Unit
    local distance = (part.Position - origin).Magnitude
    local params = RaycastParams.new()
    params.FilterDescendantsInstances = {localPlayer.Character, part.Parent}
    params.FilterType = Enum.RaycastFilterType.Blacklist
    params.IgnoreWater = true
    local result = Workspace:Raycast(origin, direction * distance, params)
    return not result
end

-- ŸÅÿ≠ÿµ FOV
local function isWithinFov(pos)
    local dir = (pos - camera.CFrame.Position).Unit
    local angle = math.deg(math.acos(camera.CFrame.LookVector:Dot(dir)))
    return angle <= settings.fov
end

-- ÿ£ŸÇÿ±ÿ® ŸáÿØŸÅ ŸÖÿ±ÿ¶Ÿä
local function getClosestEnemy()
    local closest, shortest = nil, math.huge
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= localPlayer and isEnemy(p) and isAlive(p) then
            local head = p.Character:FindFirstChild("Head")
            if head and isPartVisible(head) and isWithinFov(head.Position) then
                local dist = (head.Position - localPlayer.Character.HumanoidRootPart.Position).Magnitude
                if dist < shortest then
                    shortest = dist
                    closest = head
                end
            end
        end
    end
    return closest, shortest
end

-- ÿßŸÑÿ™ŸÜÿ®ÿ§ ÿ®ÿßŸÑÿ≠ÿ±ŸÉÿ©
local function predict(pos, vel)
    return settings.enable_prediction and (pos + vel * settings.predictionFactor) or pos
end

-- ÿ•ÿ∑ŸÑÿßŸÇ ÿ™ŸÑŸÇÿßÿ¶Ÿä
local function fire()
    VirtualUser:Button1Down(Vector2.new(), camera.CFrame)
    task.wait()
    VirtualUser:Button1Up(Vector2.new(), camera.CFrame)
end

-- ÿ™ÿ≠ÿØŸäÿ´ ÿØÿßÿ¶ÿ±ÿ© FOV
local function updateFov()
    if settings.drawFov and settings.enable_aimbot then
        if not FOVring then
            FOVring = Drawing.new("Circle")
            FOVring.Thickness = 2
            FOVring.Filled = false
            FOVring.Color = Color3.fromRGB(255, 0, 0)
        end
        FOVring.Visible = true
        FOVring.Position = camera.ViewportSize / 2
        FOVring.Radius = math.clamp(settings.fov * 4, 5, 1000)
    elseif FOVring then
        FOVring.Visible = false
    end
end

-- ÿßŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ≥ÿ™ŸÖÿ±
RunService.RenderStepped:Connect(function()
    performProtection()
    updateFov()

    if not settings.enable_aimbot then return end

    local target, dist = getClosestEnemy()
    if target then
        local aimPos = predict(target.Position, target.Velocity)
        local camPos = camera.CFrame.Position
        local smooth = math.clamp(1 / dist, 0.1, 0.5)
        camera.CFrame = CFrame.new(camPos, aimPos):Lerp(CFrame.new(camPos, aimPos), smooth)
        if settings.enable_autoattack then fire() end
    end
end)

-- ÿ≠ÿ∞ŸÅ ÿØÿßÿ¶ÿ±ÿ© FOV ÿ®ÿ≤ÿ± Delete
UserInputService.InputBegan:Connect(function(i, gp)
    if gp then return end
    if i.KeyCode == Enum.KeyCode.Delete and FOVring then
        FOVring:Remove()
        FOVring = nil
    end
end)

print("[xxxxxTheFox Aimbot ‚úÖ] ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑÿ£ŸäŸÖÿ®Ÿàÿ™ ÿ™ÿπŸÖŸÑ | ÿ•ÿπÿØÿßÿØÿßÿ™ ÿÆÿßÿ±ÿ¨Ÿäÿ© ŸÖÿ≥ÿ™ÿÆÿØŸÖÿ©.")
