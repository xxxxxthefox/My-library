-- ðŸ§  Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local VirtualUser = game:GetService("VirtualUser")

local localPlayer = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- ðŸ”’ Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¶Ø¯ Ø§Ù„ÙƒØ´Ù
local lastProtectionCheck = tick()
local protectionInterval = math.random(5, 10)
local function performAdvancedProtectionCheck()
    if not getgenv().settings.enable_protection then return end
    if tick() - lastProtectionCheck >= protectionInterval then
        lastProtectionCheck = tick()
        protectionInterval = math.random(5, 10)
        -- ÙØ­Øµ ÙˆÙ‡Ù…ÙŠØŒ ÙŠÙ…ÙƒÙ† ØªØ·ÙˆÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ù‹Ø§
        if false then
            warn("âš ï¸ ØªÙ… ÙƒØ´Ù Ø§Ù„Ø£ÙŠÙ…Ø¨ÙˆØª! ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù.")
            getgenv().settings.enable_aimbot = false
        end
    end
end

-- âœ… ÙØ­Øµ Ø§Ù„ÙØ±ÙŠÙ‚ Ø¥Ù† Ù„Ø²Ù…
local function isEnemy(player)
    if not getgenv().settings.teamCheck then
        return true -- ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ÙØ±Ù‚ØŒ ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†
    end
    return player.Team == nil or localPlayer.Team == nil or player.Team ~= localPlayer.Team
end

-- âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø­ÙŠ
local function isAlive(player)
    return player.Character and player.Character:FindFirstChild("Humanoid") and player.Character.Humanoid.Health > 0
end

-- ðŸ‘€ Ù‡Ù„ Ø§Ù„Ø¬Ø²Ø¡ Ù…Ø±Ø¦ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ (Raycast Ø¯Ù‚ÙŠÙ‚)
local function isPartVisible(part)
    local origin = camera.CFrame.Position
    local direction = (part.Position - origin).Unit
    local distance = (part.Position - origin).Magnitude

    local raycastParams = RaycastParams.new()
    raycastParams.FilterDescendantsInstances = {localPlayer.Character, part.Parent}
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.IgnoreWater = true

    local result = Workspace:Raycast(origin, direction * distance, raycastParams)
    return not result
end

-- ðŸ“¡ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø±Ø¤ÙŠØ© Ø¯Ø§Ø¦Ù…Ø§Ù‹ 360Â°
local function isWithinFov(_)
    return true
end

-- ðŸ§² Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£Ù‚Ø±Ø¨ Ø¹Ø¯Ùˆ Ù…Ø±Ø¦ÙŠ
local function getClosestVisibleEnemy()
    local closestHitbox = nil
    local shortestDistance = math.huge

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= localPlayer and isEnemy(player) and isAlive(player) then
            local head = player.Character:FindFirstChild("Head")
            if head and isPartVisible(head) and isWithinFov(head.Position) then
                local distance = (head.Position - localPlayer.Character.HumanoidRootPart.Position).Magnitude
                if distance < shortestDistance then
                    shortestDistance = distance
                    closestHitbox = head
                end
            end
        end
    end

    return closestHitbox, shortestDistance
end

-- ðŸ§  Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø­Ø±ÙƒØ©
local function predictMovement(hitbox)
    if not getgenv().settings.enable_prediction then
        return hitbox.Position
    end
    return hitbox.Position + (hitbox.Velocity * getgenv().settings.predictionFactor)
end

-- ðŸ”« Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø¥Ø·Ù„Ø§Ù‚
local function mouse1click()
    VirtualUser:Button1Down(Vector2.new(), Workspace.CurrentCamera.CFrame)
    task.wait()
    VirtualUser:Button1Up(Vector2.new(), Workspace.CurrentCamera.CFrame)
end

-- ðŸ” Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙ…Ø± ÙƒÙ„ Ø¥Ø·Ø§Ø±
RunService.RenderStepped:Connect(function()
    performAdvancedProtectionCheck()

    if not getgenv().settings.enable_aimbot then return end

    local target, distance = getClosestVisibleEnemy()
    if target then
        local targetPosition = predictMovement(target)
        local currentPosition = camera.CFrame.Position
        local smoothFactor = math.clamp(1 / distance, 0.1, 0.5)
        camera.CFrame = CFrame.new(currentPosition, targetPosition):Lerp(CFrame.new(currentPosition, targetPosition), smoothFactor)

        -- Ø¶Ø±Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ
        if getgenv().settings.enable_autoattack then
            mouse1click()
        end
    end
end)

-- ðŸŸ¢ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„
print("[xxxxxTheFox Aimbot] âœ… ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙŠÙ…Ø¨ÙˆØª - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙƒØªØ¨ÙŠØ© Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø¬Ù‡Ø© GUI")
