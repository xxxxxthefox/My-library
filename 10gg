local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local VirtualUser = game:GetService("VirtualUser")

local localPlayer = Players.LocalPlayer
local camera = Workspace.CurrentCamera
local FOVring

-- Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø©
pcall(function()
	if getgenv().settings and getgenv().settings.enable_protection then
		hookfunction(math.random, function(...) return 1 end)
	end
end)

---------------------------------------------------------------------
--  ÙØ­ÙˆØµØ§Øª (Ù†ÙØ³ Ø³ÙƒØ±Ø¨ØªÙƒ) + Ø¯Ù…Ø¬ Ø§Ù„Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶
---------------------------------------------------------------------

local function isEnemy(player)
	local settings = getgenv().settings
	if not settings then return false end
	return not settings.teamCheck or player.Team ~= localPlayer.Team
end

local function isAlive(player)
	local char = player.Character
	return char and char:FindFirstChild("Humanoid") and char.Humanoid.Health > 0
end

local function isVisible(part)
	local settings = getgenv().settings
	if not settings then return false end
	if not settings.wallCheck then return true end
	local origin = camera.CFrame.Position
	local dir = (part.Position - origin)
	local params = RaycastParams.new()
	params.FilterDescendantsInstances = {localPlayer.Character, part.Parent}
	params.FilterType = Enum.RaycastFilterType.Blacklist
	local result = Workspace:Raycast(origin, dir, params)
	return not result
end

local function inFov(pos)
	local settings = getgenv().settings
	if not settings then return false end
	local screenPos, visible = camera:WorldToViewportPoint(pos)
	if not visible then return false end
	local dist = (Vector2.new(screenPos.X, screenPos.Y) - camera.ViewportSize / 2).Magnitude
	return dist <= (settings.fov or 100)
end

local function predict(part)
	local settings = getgenv().settings
	if not settings then return part.Position end
	if settings.enable_prediction then
		return part.Position + (part.Velocity or Vector3.zero) * (settings.predictionFactor or 0.20)
	else
		return part.Position
	end
end

local function fire()
	VirtualUser:Button1Down(Vector2.zero, camera.CFrame)
	VirtualUser:Button1Up(Vector2.zero, camera.CFrame)
end

---------------------------------------------------------------------
--  Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ù‚Ø±Ø¨ Ù‡Ø¯Ù (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±)
---------------------------------------------------------------------

local function getClosestEnemy()
	local settings = getgenv().settings
	if not settings then return nil end
	local closest, minDist = nil, math.huge
	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= localPlayer and isEnemy(player) and isAlive(player) then
			local char = player.Character
			local targetPartName = settings.aimbot_target_part or "Head"
			local part = char and char:FindFirstChild(targetPartName)
			if part and isVisible(part) and inFov(part.Position) then
				local screenPos, visible = camera:WorldToViewportPoint(part.Position)
				if visible then
					local dist = (Vector2.new(screenPos.X, screenPos.Y) - camera.ViewportSize / 2).Magnitude
					if dist < minDist then
						minDist = dist
						closest = part
					end
				end
			end
		end
	end
	return closest
end

---------------------------------------------------------------------
--  Ø¯Ø§Ø¦Ø±Ø© FOV (ÙƒÙ…Ø§ Ù‡ÙŠ)
---------------------------------------------------------------------

local function updateFov()
	local settings = getgenv().settings
	if not settings then return end
	if settings.drawFov and settings.enable_aimbot then
		if not FOVring then
			FOVring = Drawing.new("Circle")
			FOVring.Thickness = 2
			FOVring.Filled = false
			FOVring.Color = Color3.fromRGB(0, 255, 0)
		end
		FOVring.Visible = true
		FOVring.Position = Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)
		FOVring.Radius = settings.fov or 100
	elseif FOVring then
		FOVring.Visible = false
	end
end

---------------------------------------------------------------------
--  â¤ï¸ðŸ”¥ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¯Ù…ÙˆØ¬Ø© Ù…Ø¹ Ø§Ù„Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ (AimLock Ø«Ø§Ø¨Øª 100%)
---------------------------------------------------------------------

RunService.Heartbeat:Connect(function()
	local settings = getgenv().settings
	if not settings or not settings.enable_aimbot then
		if FOVring then FOVring.Visible = false end
		return
	end

	updateFov()

	local target = getClosestEnemy()
	if target then
		local aim = predict(target)

		-- ðŸ”¥ðŸ”¥ðŸ”¥ ØªØ«Ø¨ÙŠØª ØºØ±ÙŠØ¨ + Ù‚Ø§Ø³ÙŠ + Ù…Ø±ÙŠØ¶
		local camPos = camera.CFrame.Position
		local locked = CFrame.lookAt(camPos, aim)

		-- 1 = Ø¨Ø¯ÙˆÙ† Ø³Ù…ÙˆØ«ØŒ Ø¨Ø¯ÙˆÙ† ØªØ£Ø®ÙŠØ±ØŒ Ø§Ù„ØªØµØ§Ù‚ Ù…Ø¨Ø§Ø´Ø±
		camera.CFrame = camera.CFrame:Lerp(locked, 1)

		if settings.enable_autoattack then
			fire()
		end
	end
end)

print("[xxxxxTheFox Aimbot] ðŸ”¥ ØªÙ… Ø§Ù„Ø¯Ù…Ø¬ â€” Ø§Ù„Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¬Ø§Ù‡Ø²!")
